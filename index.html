<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Pulse-go by taskcluster</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Pulse-go</h1>
      <h2 class="project-tagline">Go (golang) client for pulse.mozilla.org</h2>
      <a href="https://github.com/taskcluster/pulse-go" class="btn">View on GitHub</a>
      <a href="https://github.com/taskcluster/pulse-go/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/taskcluster/pulse-go/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="pulse-go" class="anchor" href="#pulse-go" aria-hidden="true"><span class="octicon octicon-link"></span></a>pulse-go</h1>

<p><img hspace="20" align="left" src="https://tools.taskcluster.net/lib/assets/taskcluster-120.png">
<a href="http://travis-ci.org/taskcluster/pulse-go"><img src="https://secure.travis-ci.org/taskcluster/pulse-go.png" alt="Build Status"></a>
<a href="https://godoc.org/github.com/taskcluster/pulse-go"><img src="https://godoc.org/github.com/taskcluster/pulse-go?status.png" alt="GoDoc"></a></p>

<p>A go (golang) library for consuming mozilla pulse messages (<a href="http://pulse.mozilla.org/">http://pulse.mozilla.org/</a>).</p>

<h2>
<a id="this-project-contains-three-go-packages" class="anchor" href="#this-project-contains-three-go-packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>This project contains three go packages:</h2>

<h1>
<a id="package-1-githubcomtaskclusterpulse-go" class="anchor" href="#package-1-githubcomtaskclusterpulse-go" aria-hidden="true"><span class="octicon octicon-link"></span></a>Package 1: "github.com/taskcluster/pulse-go"</h1>

<p>This is a command line interface for consuming mozilla pulse messages, written in go.</p>

<p>The best way to see how to use this command line tool, is to run it with the --help option:</p>

<pre><code>pmoore@home:~ $ pulse-go --help
pulse-go
pulse-go is a very simple command line utility that allows you to specify a list of Pulse
exchanges/routing keys that you wish to bind to, and prints the body of the Pulse messages
to standard out.

Derivation of username, password and AMQP server url
====================================================
If no AMQP server is specified, production will be used (amqps://pulse.mozilla.org:5671).

If a pulse username is specified on the command line, it will be used.
Otherwise, if the AMQP server url is provided and contains a username, it will be used.
Otherwise, if a value is set in the environment variable PULSE_USERNAME, it will be used.
Otherwise the value 'guest' will be used.

If a pulse password is specified on the command line, it will be used.
Otherwise, if the AMQP server url is provided and contains a password, it will be used.
Otherwise, if a value is set in the environment variable PULSE_PASSWORD, it will be used.
Otherwise the value 'guest' will be used.

  Usage:
      pulse-go [-u &lt;pulse_user&gt;] [-p &lt;pulse_password&gt;] [-s &lt;amqp_server_url&gt;] (&lt;exchange&gt; &lt;routing_key&gt;)...
      pulse-go -h | --help

  Options:
    -h, --help            Display this help text.
    -u &lt;pulse_user&gt;       The pulse user to connect with (see http://pulse.mozilla.org/).
    -p &lt;pulse_password&gt;   The password to use for connecting to pulse.
    -s &lt;amqp_server_url&gt;  The full amqp/amqps url to use for connecting to the pulse server.

  Examples:
    1)  pulse-go -u pmoore_test1 -p potato123 \
        exchange/build/ '#' \
        exchange/taskcluster-queue/v1/task-defined '*.*.*.*.*.null-provisioner.buildbot-try.#'

    This would display all messages from exchange exchange/build/ and only messages from
    exchange/taskcluster-queue/v1/task-defined with provisionerId = "null-provisioner" and
    workerType = "buildbot-try" (see http://docs.taskcluster.net/queue/exchanges/#taskDefined
    for more information).

    Remember to quote your routing key strings on the command line, so they are not
    interpreted by your shell!

    Please note if you are interacting with taskcluster exchanges, please consider using one
    of the following libraries, for better handling:

      * https://github.com/taskcluster/taskcluster-client-go
      * https://github.com/taskcluster/taskcluster-client

    2) pulse-go -s amqps://admin:peanuts@localhost:5671 exchange/treeherder/v2/new-result-set '#'

    This would match all messages on the given exchange, published to the local AMQP service
    running on localhost. Notice that the user and password are given as part of the url.
pmoore@home:~ $ 
</code></pre>

<h1>
<a id="package-2-githubcomtaskclusterpulse-gopulse" class="anchor" href="#package-2-githubcomtaskclusterpulse-gopulse" aria-hidden="true"><span class="octicon octicon-link"></span></a>Package 2: "github.com/taskcluster/pulse-go/pulse"</h1>

<p>This is a pulse client library, written in go.</p>

<p>The full API documentation is available at <a href="http://godoc.org/github.com/taskcluster/pulse-go/pulse">http://godoc.org/github.com/taskcluster/pulse-go/pulse</a></p>

<h1>
<a id="package-3-githubcomtaskclusterpulse-gopulsesniffer" class="anchor" href="#package-3-githubcomtaskclusterpulse-gopulsesniffer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Package 3: "github.com/taskcluster/pulse-go/pulsesniffer"</h1>

<p>This package contains the following <em>example</em> program, which uses the pulse library (package 2 above).</p>

<div class="highlight highlight-go"><pre><span class="pl-c">// Package pulsesniffer provides a simple example program that listens to some</span>
<span class="pl-c">// real world pulse messages.</span>
<span class="pl-k">package</span> main

<span class="pl-k">import</span> (
    <span class="pl-s"><span class="pl-pds">"</span>fmt<span class="pl-pds">"</span></span>
    <span class="pl-s"><span class="pl-pds">"</span>github.com/taskcluster/pulse-go/pulse<span class="pl-pds">"</span></span>
    <span class="pl-s"><span class="pl-pds">"</span>github.com/streadway/amqp<span class="pl-pds">"</span></span>
)

<span class="pl-k">func</span> <span class="pl-en">main</span>() {
    <span class="pl-c">// Passing all empty strings:</span>
    <span class="pl-c">// empty user =&gt; use PULSE_USERNAME env var</span>
    <span class="pl-c">// empty password =&gt; use PULSE_PASSWORD env var</span>
    <span class="pl-c">// empty url =&gt; connect to production</span>
    <span class="pl-smi">conn</span> <span class="pl-k">:=</span> pulse.<span class="pl-c1">NewConnection</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
    conn.<span class="pl-c1">Consume</span>(
        <span class="pl-s"><span class="pl-pds">"</span>taskprocessing<span class="pl-pds">"</span></span>, <span class="pl-c">// queue name</span>
        <span class="pl-c1">func</span>(message <span class="pl-k">interface</span>{}, delivery amqp.<span class="pl-smi">Delivery</span>) { <span class="pl-c">// callback function to pass messages to</span>
            fmt.<span class="pl-c1">Println</span>(<span class="pl-s"><span class="pl-pds">"</span>Received from exchange <span class="pl-pds">"</span></span> + delivery.<span class="pl-smi">Exchange</span> + <span class="pl-s"><span class="pl-pds">"</span>:<span class="pl-pds">"</span></span>)
            fmt.<span class="pl-c1">Println</span>(<span class="pl-k">string</span>(delivery.<span class="pl-smi">Body</span>))
            fmt.<span class="pl-c1">Println</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
            delivery.<span class="pl-c1">Ack</span>(<span class="pl-c1">false</span>) <span class="pl-c">// acknowledge message *after* processing</span>
        },
        <span class="pl-c1">1</span>,     <span class="pl-c">// prefetch 1 message at a time</span>
        <span class="pl-c1">false</span>, <span class="pl-c">// don't auto-acknowledge messages</span>
        pulse.<span class="pl-c1">Bind</span>( <span class="pl-c">// routing key and exchange to get messages from</span>
            <span class="pl-s"><span class="pl-pds">"</span>*.*.*.*.*.*.gaia.#<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>exchange/taskcluster-queue/v1/task-defined<span class="pl-pds">"</span></span>),
        pulse.<span class="pl-c1">Bind</span>( <span class="pl-c">// another routing key and exchange to get messages from</span>
            <span class="pl-s"><span class="pl-pds">"</span>*.*.*.*.*.aws-provisioner.#<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>exchange/taskcluster-queue/v1/task-running<span class="pl-pds">"</span></span>))
    conn.<span class="pl-c1">Consume</span>( <span class="pl-c">// a second workflow to manage concurrently</span>
        <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-c">// empty name implies anonymous queue</span>
        <span class="pl-c1">func</span>(message <span class="pl-k">interface</span>{}, delivery amqp.<span class="pl-smi">Delivery</span>) { <span class="pl-c">// simpler callback than before</span>
            fmt.<span class="pl-c1">Println</span>(<span class="pl-s"><span class="pl-pds">"</span>Buildbot message received<span class="pl-pds">"</span></span>)
            fmt.<span class="pl-c1">Println</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
        },
        <span class="pl-c1">1</span>,    <span class="pl-c">// prefetch</span>
        <span class="pl-c1">true</span>, <span class="pl-c">// auto acknowledge, so no need to call delivery.Ack</span>
        pulse.<span class="pl-c1">Bind</span>( <span class="pl-c">// routing key and exchange to get messages from</span>
            <span class="pl-s"><span class="pl-pds">"</span>#<span class="pl-pds">"</span></span>, <span class="pl-c">// get *all* normalized buildbot messages</span>
            <span class="pl-s"><span class="pl-pds">"</span>exchange/build/normalized<span class="pl-pds">"</span></span>))
    <span class="pl-c">// wait forever</span>
    <span class="pl-smi">forever</span> <span class="pl-k">:=</span> <span class="pl-c1">make</span>(<span class="pl-k">chan</span> <span class="pl-k">bool</span>)
    <span class="pl-k">&lt;-</span>forever
}</pre></div>

<p>Travis build success/failure messages are posted to irc channel #tcclient-go on irc.mozilla.org:6697.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/taskcluster/pulse-go">Pulse-go</a> is maintained by <a href="https://github.com/taskcluster">taskcluster</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
