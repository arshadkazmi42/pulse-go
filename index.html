<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pulse-go by petemoore</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Pulse-go</h1>
        <p class="header">Go (golang) client for pulse.mozilla.org</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/petemoore/pulse-go/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/petemoore/pulse-go/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/petemoore/pulse-go">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/petemoore">petemoore</a></p>


      </header>
      <section>
        <h1>
<a id="pulse-go" class="anchor" href="#pulse-go" aria-hidden="true"><span class="octicon octicon-link"></span></a>pulse-go</h1>

<p><img hspace="20" align="left" src="https://tools.taskcluster.net/lib/assets/taskcluster-120.png">
<a href="http://travis-ci.org/petemoore/pulse-go"><img src="https://secure.travis-ci.org/petemoore/pulse-go.png" alt="Build Status"></a></p>

<p>A go (golang) library for consuming mozilla pulse messages (<a href="http://pulse.mozilla.org/">http://pulse.mozilla.org/</a>).</p>

<p>This project contains two go packages:</p>

<h1>
<a id="package-githubcompetemoorepulse-go" class="anchor" href="#package-githubcompetemoorepulse-go" aria-hidden="true"><span class="octicon octicon-link"></span></a>package "github.com/petemoore/pulse-go"</h1>

<p>This is a command line interface for consuming mozilla pulse messages, written in go.</p>

<p>The best way to see how to use this command line tool, is to run it with the --help option:</p>

<pre><code>pmoore@home:~ $ pulse-go --help
pulse-go
pulse-go is a very simple command line utility that allows you to specify a list of Pulse
exchanges/routing keys that you wish to bind to, and prints the body of the Pulse messages
to standard out.

Derivation of username, password and AMQP server url
====================================================
If no AMQP server is specified, production will be used (amqps://pulse.mozilla.org:5671).

If a pulse username is specified on the command line, it will be used.
Otherwise, if the AMQP server url is provided and contains a username, it will be used.
Otherwise, if a value is set in the environment variable PULSE_USERNAME, it will be used.
Otherwise the value 'guest' will be used.

If a pulse password is specified on the command line, it will be used.
Otherwise, if the AMQP server url is provided and contains a password, it will be used.
Otherwise, if a value is set in the environment variable PULSE_PASSWORD, it will be used.
Otherwise the value 'guest' will be used.

  Usage:
      pulse-go [-u &lt;pulse_user&gt;] [-p &lt;pulse_password&gt;] [-s &lt;amqp_server_url&gt;] (&lt;exchange&gt; &lt;routing_key&gt;)...
      pulse-go -h | --help

  Options:
    -h, --help            Display this help text.
    -u &lt;pulse_user&gt;       The pulse user to connect with (see http://pulse.mozilla.org/).
    -p &lt;pulse_password&gt;   The password to use for connecting to pulse.
    -s &lt;amqp_server_url&gt;  The full amqp/amqps url to use for connecting to the pulse server.

  Examples:
    1)  pulse-go -u pmoore_test1 -p potato123 \
        exchange/build/ '#' \
        exchange/taskcluster-queue/v1/task-defined '*.*.*.*.*.null-provisioner.buildbot-try.#'

    This would display all messages from exchange exchange/build/ and only messages from
    exchange/taskcluster-queue/v1/task-defined with provisionerId = "null-provisioner" and
    workerType = "buildbot-try" (see http://docs.taskcluster.net/queue/exchanges/#taskDefined
    for more information).

    Remember to quote your routing key strings on the command line, so they are not
    interpreted by your shell!

    Please note if you are interacting with taskcluster exchanges, please consider using one
    of the following libraries, for better handling:

      * https://github.com/petemoore/taskcluster-client-go
      * https://github.com/taskcluster/taskcluster-client

    2) pulse-go -s amqps://admin:peanuts@localhost:5671 exchange/treeherder/v2/new-result-set '#'

    This would match all messages on the given exchange, published to the local AMQP service
    running on localhost. Notice that the user and password are given as part of the url.
pmoore@home:~ $ 
</code></pre>

<h1>
<a id="package-githubcompetemoorepulse-gopulse" class="anchor" href="#package-githubcompetemoorepulse-gopulse" aria-hidden="true"><span class="octicon octicon-link"></span></a>package "github.com/petemoore/pulse-go/pulse"</h1>

<p>This is a pulse client library, written in go.</p>

<p>The full API documentation is available at <a href="http://godoc.org/github.com/petemoore/pulse-go/pulse">http://godoc.org/github.com/petemoore/pulse-go/pulse</a>
including a full explanation of the following walkthrough example:</p>

<pre><code>package main
import (
    "fmt"
    "github.com/petemoore/pulse-go/pulse"
    "github.com/streadway/amqp"
)
func main() {
    // Passing all empty strings:
    // empty user =&gt; use PULSE_USERNAME env var
    // empty password =&gt; use PULSE_PASSWORD env var
    // empty url =&gt; connect to production
    conn := pulse.NewConnection("", "", "")
    conn.Consume(
        "taskprocessing", // queue name
        func(delivery amqp.Delivery) { // callback function to pass messages to
            fmt.Println("Received from exchange " + delivery.Exchange + ":")
            fmt.Println(string(delivery.Body))
            fmt.Println("")
            delivery.Ack(false) // acknowledge message *after* processing
        },
        1,     // prefetch 1 message at a time
        false, // don't auto-acknowledge messages
        pulse.Bind( // routing key and exchange to get messages from
            "*.*.*.*.*.*.gaia.#",
            "exchange/taskcluster-queue/v1/task-defined"),
        pulse.Bind( // another routing key and exchange to get messages from
            "*.*.*.*.*.aws-provisioner.#",
            "exchange/taskcluster-queue/v1/task-running"))
    conn.Consume( // a second workflow to manage concurrently
        "", // empty name implies anonymous queue
        func(delivery amqp.Delivery) { // simpler callback than before
            fmt.Println("Buildbot message received")
            fmt.Println("")
        },
        1,    // prefetch
        true, // auto acknowledge, so no need to call delivery.Ack
        pulse.Bind( // routing key and exchange to get messages from
            "#", // get *all* normalized buildbot messages
            "exchange/build/normalized"))
    // wait forever
    forever := make(chan bool)
    &lt;-forever
}
</code></pre>

<p>Travis build success/failure messages are posted to irc channel #tcclient-go on irc.mozilla.org:6697.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
